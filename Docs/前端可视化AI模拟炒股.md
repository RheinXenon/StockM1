# 前端可视化AI模拟炒股

## 功能概述

前端可视化AI模拟炒股功能提供了一个Web界面，用于配置、运行和监控AI Agent进行股票交易模拟。该功能完全仿照终端运行`run_mvp.py`的行为，提供实时的日志记录、决策分析和交易监控。

## 访问方式

在项目根目录运行：
```bash
python run_visualization.py
```

然后在浏览器中访问显示的地址（通常是 http://localhost:8501），选择 "💻 AI Agent模拟炒股" 页面。

## 主要功能

### 1. 配置管理

#### API配置
- **API Base URL**: API服务地址
- **API Key**: API密钥（加密显示）
- **模型名称**: 使用的模型（如 qwen3-max, free:Qwen3-30B-A3B）
- **API调用间隔**: 控制API调用频率（秒）

#### 模型参数
- **Temperature**: 控制输出随机性（0.0-2.0）
- **Max Tokens**: 最大输出长度
- **历史数据窗口**: Agent可查看的历史天数

#### 系统提示词
- 自定义Agent的角色、目标和交易策略
- 支持恢复默认提示词

#### 交易设置
- **初始资金**: 模拟交易的起始资金
- **股票池**: 从数据库选择可交易股票
- **模拟时间**: 设置开始和结束日期

### 2. 运行控制

- **🚀 初始化Agent**: 根据配置创建Agent实例
- **▶️ 开始运行**: 启动模拟交易
- **⏸️ 暂停**: 暂停当前运行
- **▶️ 继续**: 恢复暂停的运行
- **⏹️ 终止**: 停止运行并关闭日志

### 3. 实时监控

#### 状态概览
- 运行状态（运行中/已暂停/已停止）
- 当前交易日期
- 模拟进度和完成度

#### 账户状态
- 实时现金、市值、总资产
- 收益率（带正负标识）
- 持仓详情：股票代码、名称、数量、成本价、现价、盈亏、收益率

#### 资产曲线
- 总资产、现金、市值变化曲线
- 收益率变化曲线

#### 交易记录
- 完整交易历史表格，包含：
  - 日期、类型（买入/卖出）
  - **股票代码**
  - **股票名称**（新增）
  - 数量、价格、金额
- 交易统计：总次数、买入次数、卖出次数

#### 运行日志
- 显示Agent的决策思考过程，包括：
  - **决策分析**: Agent对市场的分析
  - **决策理由**: 交易决策的详细理由
  - 交易执行结果
  - 账户状态更新
- 支持日志级别过滤（info/success/warning/error）
- 自动显示最近200条日志

## 日志系统

### 文件日志

模拟运行时自动在 `Agents_Experience\logs` 目录下生成两个日志文件：

1. **决策日志** (`agent_<model>_decision_<timestamp>.log`)
   - 记录每日AI决策的完整过程
   - 包含市场分析、决策理由、工具调用、交易决策
   - 格式与终端运行`run_mvp.py`完全一致

2. **资产日志** (`agent_<model>_portfolio_<timestamp>.csv`)
   - CSV格式记录每日资产情况
   - 包含日期、现金、市值、总资产、收益率、持仓详情

### 前端日志

在"📝 运行日志"标签页中实时显示：
- 决策分析和理由（带格式化显示）
- 交易执行情况
- 系统状态更新
- 错误和警告信息

## 使用流程

1. **配置设置**
   - 在"⚙️ 配置设置"中设置API、模型参数、股票池和时间范围
   - 点击"💾 保存配置"保存到 `Agents_Experience/user_setting.ini`

2. **初始化**
   - 点击"🚀 初始化Agent"创建Agent实例
   - 系统会创建日志文件并准备交易环境

3. **运行模拟**
   - 点击"▶️ 开始运行"启动模拟
   - 实时观察决策过程、交易记录和资产变化
   - 可随时暂停或终止

4. **查看结果**
   - 在各个标签页查看实时数据
   - 完成后在 `Agents_Experience\logs` 查看完整日志文件

## 技术特性

- **多线程运行**: Agent在后台线程运行，不阻塞UI
- **实时更新**: 自动刷新显示最新状态（每秒）
- **完整日志**: 文件日志与终端运行完全一致
- **断点恢复**: 支持暂停和继续，可随时查看中间状态
- **配置持久化**: 配置保存到文件，下次启动自动加载

## 注意事项

1. 首次使用需确保已配置正确的API Key
2. 股票池必须选择至少一只股票
3. 时间范围内必须有可用的交易数据
4. 运行过程中会调用API，请注意API配额和调用间隔
5. 日志文件会持续增长，定期清理旧日志

## 相关文件

- 前端页面: `visualization/agent_simulator_page.py`
- 运行控制器: `visualization/agent_runner.py`
- 配置管理: `visualization/agent_config_manager.py`
- 日志系统: `Agents_Experience/utils/logger.py`
- 模拟器核心: `Agents_Experience/core/simulator.py`
